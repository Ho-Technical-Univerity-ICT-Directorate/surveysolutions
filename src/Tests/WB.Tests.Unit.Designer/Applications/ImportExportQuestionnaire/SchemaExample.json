{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://docs.mysurvey.solutions/schemas/questionnaire.schema.json",
  "title": "Questionnaire Document",
  "description": "Survey Solutions questionnaire document",
  "type": "object",
  "additionalProperties": false,
  
  "properties": {
    "CoverPage": { "$ref": "#/definitions/CoverPage" },
    "DefaultTranslation": { "$ref": "#/definitions/GUID" },
    "Id": { "$ref": "#/definitions/GUID" },
    "Title": { "type": "string" },
    "Description": { "type": "string" },
    "VariableName": { "$ref": "#/definitions/VariableName" },
    "HideIfDisabled": { "type": "boolean", "default": false },
    "Children": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/Group"
      },
      "minItems": 0
    },
    "Macros": {
      "type": "object",
      "additionalProperties": {
        "$ref": "#/definitions/Macro"
      }
    },
    "LookupTables": {
      "type": "object",
      "additionalProperties": {
        "$ref": "#/definitions/LookupTable"
      }
    },
    "Attachments": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/Attachment"
      }
    },
    "Translations": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/Translation"
      }
    },
    "Categories": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/Categories"
      }
    },
    "Metadata": { "$ref": "#/definitions/QuestionnaireMetaInfo" }
  },

  "required": ["Id", "Children", "Title"],

  "definitions": {
    "Answer": {
      "type": "object",
      "properties": {
        "Text": { "type": "string" },
        "Code": { "type": "number" },
        "ParentCode": { "type": "number" },
      },
      "additionalProperties": false,
      "required": ["Text", "Code"]
    },
  
    "Answers": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/Answer"
      }
    },

    "AreaQuestion": {
      "type": "object",
      "properties": {
        "Type": { "const": "AreaQuestion" },
        "ConditionExpression": { "type": "string" },
        "HideIfDisabled": { "type": "boolean", "default": false },
        "Instructions": { "type": "string" },
        "HideInstructions": { "type": "boolean", "default": false },
        "GeometryType": {
          "type": "string",
          "oneOf": [
            { "const": "Polygon",    "description": "Polygon" },
            { "const": "Polyline",   "description": "Polyline" },
            { "const": "Point",      "description": "Point" },
            { "const": "Multipoint", "description": "Multipoint" }
          ],
          "default": "Polygon"
        },
        "Id": { "$ref": "#/definitions/GUID" },
        "QuestionScope": { "$ref": "#/definitions/QuestionScope" },
        "QuestionText": { "type": "string" },
        "VariableLabel": { "$ref": "#/definitions/VariableLabel" },
        "ValidationConditions": { "$ref": "#/definitions/ValidationConditions" },
        "VariableName": { "$ref": "#/definitions/VariableName" }
      },
      "additionalProperties": false,
      "required": ["Type", "Id"]
    },

    "Attachment": {
      "type": "object",
      "properties": {
        "AttachmentId": { "type": "string" },
        "Name": { "type": "string" }
      },
      "additionalProperties": false,
      "required": ["AttachmentId", "Name" ]
    },

    "AudioQuestion": {
      "type": "object",
      "properties": {
        "Type": { "const": "AudioQuestion" },
        "ConditionExpression": { "type": "string" },
        "HideIfDisabled": { "type": "boolean", "default": false },
        "Instructions": { "type": "string" },
        "HideInstructions": { "type": "boolean", "default": false },
        "Id": { "$ref": "#/definitions/GUID" },
        "QuestionScope": { "$ref": "#/definitions/QuestionScope" },
        "QuestionText": { "type": "string" },
        "VariableLabel": { "$ref": "#/definitions/VariableLabel" },
        "ValidationConditions": { "$ref": "#/definitions/ValidationConditions" },
        "VariableName": { "$ref": "#/definitions/VariableName" }
      },
      "additionalProperties": false,
      "required": ["Type", "Id"]
    },

    "Categories": {
      "type": "object",
      "properties": {
        "Id": { "type": "string" },
        "Name": { "type": "string" }
      },
      "additionalProperties": false,
      "required": ["Id", "Name"]
    },

    "DateTimeQuestion": {
      "type": "object",
      "properties": {
        "Type": { "const": "DateTimeQuestion" },
        "ConditionExpression": { "type": "string" },
        "HideIfDisabled": { "type": "boolean", "default": false },
        "Instructions": { "type": "string" },
        "HideInstructions": { "type": "boolean", "default": false },
        "IsTimestamp": { "type": "boolean", "default": false },
        "DefaultDate": { "type": "string", "format": "date-time" },
        "Id": { "$ref": "#/definitions/GUID" },
        "QuestionScope": { "$ref": "#/definitions/QuestionScope" },
        "QuestionText": { "type": "string" },
        "VariableLabel": { "$ref": "#/definitions/VariableLabel" },
        "ValidationConditions": { "$ref": "#/definitions/ValidationConditions" },
        "VariableName": { "$ref": "#/definitions/VariableName" }
      },
      "additionalProperties": false,
      "required": ["Type" , "Id"]
    },

    "FixedRosterTitle": {
      "type": "object",
      "properties": {
        "Value": { "type": "number" },
        "Title": { "type": "string" }
      },
      "additionalProperties": false,
      "required": ["Value", "Title"]
    },

    "GpsCoordinateQuestion": {
      "type": "object",
      "properties": {
        "Type": { "const": "GpsCoordinateQuestion" },
        "ConditionExpression": { "type": "string" },
        "HideIfDisabled": { "type": "boolean", "default": false },
        "Instructions": { "type": "string" },
        "HideInstructions": { "type": "boolean", "default": false },
        "Id": { "$ref": "#/definitions/GUID" },
        "QuestionScope": { "$ref": "#/definitions/QuestionScope" },
        "QuestionText": { "type": "string" },
        "VariableLabel": { "$ref": "#/definitions/VariableLabel" },
        "ValidationConditions": { "$ref": "#/definitions/ValidationConditions" },
        "VariableName": { "$ref": "#/definitions/VariableName" }
      },
      "additionalProperties": false,
      "required": ["Type", "Id"]
    },
    
    "CoverPage": {
      "type": "object",
      "properties": {
        "Type": {"const": "CoverPage"},
        "Children": {
          "type": "array",
          "items": {
            "oneOf": [
              {"$ref": "#/definitions/StaticText"},
              {"$ref": "#/definitions/DateTimeQuestion"},
              {"$ref": "#/definitions/GpsCoordinateQuestion"},
              {"$ref": "#/definitions/NumericQuestion"},
              {"$ref": "#/definitions/SingleQuestion"},
              {"$ref": "#/definitions/TextQuestion"},
              {"$ref": "#/definitions/Variable"}
            ]
          }
        },
        "Id": { "$ref": "#/definitions/GUID" },
        "Title": { "type": "string" },
        "VariableName": { "$ref": "#/definitions/VariableName" }
      },

      "additionalProperties": false,
      "required": [ "Id"]
    },

    "Group": {
      "type": "object",
      "properties": {
        "Type": {"const": "Group"},
        "Children": {
          "type": "array",
          "items": {
            "oneOf": [
              {"$ref": "#/definitions/Group"},
              {"$ref": "#/definitions/Roster"},
              {"$ref": "#/definitions/StaticText"},
              {"$ref": "#/definitions/AreaQuestion"},
              {"$ref": "#/definitions/AudioQuestion"},
              {"$ref": "#/definitions/DateTimeQuestion"},
              {"$ref": "#/definitions/GpsCoordinateQuestion"},
              {"$ref": "#/definitions/PictureQuestion"},
              {"$ref": "#/definitions/MultiOptionsQuestion"},
              {"$ref": "#/definitions/NumericQuestion"},
              {"$ref": "#/definitions/QRBarcodeQuestion"},
              {"$ref": "#/definitions/SingleQuestion"},
              {"$ref": "#/definitions/TextListQuestion"},
              {"$ref": "#/definitions/TextQuestion"},
              {"$ref": "#/definitions/Variable"}
            ]
          }
        },
        "ConditionExpression": { "type": "string" },
        "HideIfDisabled": { "type": "boolean", "default": false },
        "IsRoster": { "type": "boolean", "default": false },
        "Id": { "$ref": "#/definitions/GUID" },
        "Title": { "type": "string" },
        "VariableName": { "$ref": "#/definitions/VariableName" },
      },

      "additionalProperties": false,
      "required": ["Type", "Id"]
    },

    "Roster": {
      "type": "object",
      "properties": {
        "Type": {"const": "Roster"},
        "Children": {
          "type": "array",
          "items": {
            "oneOf": [
              {"$ref": "#/definitions/Group"},
              {"$ref": "#/definitions/Roster"},
              {"$ref": "#/definitions/StaticText"},
              {"$ref": "#/definitions/AreaQuestion"},
              {"$ref": "#/definitions/AudioQuestion"},
              {"$ref": "#/definitions/DateTimeQuestion"},
              {"$ref": "#/definitions/GpsCoordinateQuestion"},
              {"$ref": "#/definitions/PictureQuestion"},
              {"$ref": "#/definitions/MultiOptionsQuestion"},
              {"$ref": "#/definitions/NumericQuestion"},
              {"$ref": "#/definitions/QRBarcodeQuestion"},
              {"$ref": "#/definitions/SingleQuestion"},
              {"$ref": "#/definitions/TextListQuestion"},
              {"$ref": "#/definitions/TextQuestion"},
              {"$ref": "#/definitions/Variable"}
            ]
          }
        },
        "ConditionExpression": { "type": "string" },
        "HideIfDisabled": { "type": "boolean", "default": false },
        "IsRoster": { "type": "boolean", "default": false },
        "Id": { "$ref": "#/definitions/GUID" },
        "Title": { "type": "string" },
        "VariableName": { "$ref": "#/definitions/VariableName" },

        "DisplayMode": {
          "type": "string",
          "oneOf": [
            { "const": "SubSection", "description": "Sub Section" },
            { "const": "Flat", "description": "Flat" },
            { "const": "Table", "description": "Table" },
            { "const": "Matrix", "description": "Matrix" }
          ],
          "default": "SubSection"
        },
        "RosterSizeQuestionId": { "$ref": "#/definitions/GUID" },
        "RosterTitleQuestionId": { "$ref": "#/definitions/GUID" },
        "RosterSizeSource": {
          "type": "string",
          "oneOf": [
            { "const": "FixedTitles", "description": "Fixed Titles" },
            { "const": "Question", "description": "Question" },
          ],
          "default": "FixedTitles"
        },
        "FixedRosterTitles": {
          "type": [ "array", "null" ],
          "items": {
            "$ref": "#/definitions/FixedRosterTitle"
          }
        }
      },

      "if" : {
        "properties" : { "IsRoster": { "const": true } }
      },
      "then": {
        "properties": {

        }
      },
      "additionalProperties": false,
      "required": ["Type", "Id"]
    },

    "GUID": { "type": "string", "format": "uuid" },

    "ValidationConditions": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/ValidationCondition"
      },
      "maxItems": 10
    },

    "LookupTable": {
      "type": "object",
      "properties": {
        "TableName": {"type": "string"},
        "FileName": {"type": "string"}
      },
      "additionalProperties": false,
      "required": ["TableName", "FileName"]
    },

    "Macro": {
      "type": "object",
      "properties": {
        "Name": { "type": "string" },
        "Content": { "type": "string" },
        "Description": { "type": "string" }
      },
      "additionalProperties": false,
      "required": ["Name", "Content"]
    },

    "PictureQuestion": {
      "Type": "object",
      "properties": {
        "Type": { "const": "PictureQuestion" },
        "IsSignature": { "type": "boolean", "default": false },
        "ConditionExpression": { "type": "string" },
        "HideIfDisabled": { "type": "boolean", "default": false },
        "Instructions": { "type": "string" },
        "HideInstructions": { "type": "boolean", "default": false },
        "Id": { "$ref": "#/definitions/GUID" },
        "QuestionScope": { "$ref": "#/definitions/QuestionScope" },
        "QuestionText": { "type": "string" },
        "VariableLabel": { "$ref": "#/definitions/VariableLabel" },
        "ValidationConditions": { "$ref": "#/definitions/ValidationConditions" },
        "VariableName": { "$ref": "#/definitions/VariableName" }
      },
      "additionalProperties": false,
      "required": ["Id", "Type"]
    },

    "MultiOptionsQuestion": {
      "type": "object",
      "properties": {
        "Type": { "const": "MultiOptionsQuestion" },
        "ConditionExpression": { "type": "string" },
        "HideIfDisabled": { "type": "boolean", "default": false },
        "Instructions": { "type": "string" },
        "HideInstructions": { "type": "boolean", "default": false },
        "Id": { "$ref": "#/definitions/GUID" },
        "QuestionScope": { "$ref": "#/definitions/QuestionScope" },
        "QuestionText": { "type": "string" },
        "VariableLabel": { "$ref": "#/definitions/VariableLabel" },
        "ValidationConditions": { "$ref": "#/definitions/ValidationConditions" },
        "VariableName": { "$ref": "#/definitions/VariableName" },

        "AreAnswersOrdered": { "type": "boolean", "default": false },
        "MaxAllowedAnswers": { "type": "integer", "minimum": 2 },
        "YesNoView": { "type": "boolean", "default": false },

        "CategoriesId": { "$ref": "#/definitions/GUID" },
        "Answers": { "$ref": "#/definitions/Answers" },
        "CascadeFromQuestionId": { "$ref": "#/definitions/GUID" },

        "IsFilteredCombobox": { "type": "boolean", "default": false },
        "FilterExpression": { "type": "string" },
        "LinkedToId": { "$ref": "#/definitions/GUID" },
      },
      "additionalProperties": false,
      "required": ["Id", "Type"]
    },

    "NumericQuestion": {
      "type": "object",
      "properties": {
        "Type": { "const": "NumericQuestion" },
        "ConditionExpression": { "type": "string" },
        "HideIfDisabled": { "type": "boolean", "default": false },
        "Instructions": { "type": "string" },
        "HideInstructions": { "type": "boolean", "default": false },
        "Id": { "$ref": "#/definitions/GUID" },
        "QuestionScope": { "$ref": "#/definitions/QuestionScope" },
        "QuestionText": { "type": "string" },
        "VariableLabel": { "$ref": "#/definitions/VariableLabel" },
        "ValidationConditions": { "$ref": "#/definitions/ValidationConditions" },
        "VariableName": { "$ref": "#/definitions/VariableName" },

        "Answers": { "$ref": "#/definitions/Answers" },
        "DecimalPlaces": { "type": "integer", "minimum": 0 },
        "IsInteger": { "type": "boolean", "default": true },
        "UseThousandsSeparator": { "type": "boolean", "default": false }
      },
      "additionalProperties": false,
      "required": ["Id", "Type"]
    },

    "QRBarcodeQuestion": {
      "type": "object",
      "properties": {
        "Type": { "const": "QRBarcodeQuestion" },
        "ConditionExpression": { "type": "string" },
        "HideIfDisabled": { "type": "boolean", "default": false },
        "Instructions": { "type": "string" },
        "HideInstructions": { "type": "boolean", "default": false },
        "Id": { "$ref": "#/definitions/GUID" },
        "QuestionScope": { "$ref": "#/definitions/QuestionScope" },
        "QuestionText": { "type": "string" },
        "VariableLabel": { "$ref": "#/definitions/VariableLabel" },
        "ValidationConditions": { "$ref": "#/definitions/ValidationConditions" },
        "VariableName": { "$ref": "#/definitions/VariableName" }
      },
      "additionalProperties": false,
      "required": ["Id", "Type"]
    },

    "QuestionScope": {
      "type": "string",
      "enum": [
        "Interviewer",
        "Supervisor",
        "Hidden"
      ],
      "default": "Interviewer"
    },

    "SingleQuestion": {
      "type": "object",
      "properties": {
        "Type": { "const": "SingleQuestion" },
        "ConditionExpression": { "type": "string" },
        "HideIfDisabled": { "type": "boolean", "default": false },
        "Instructions": { "type": "string" },
        "HideInstructions": { "type": "boolean", "default": false },
        "Id": { "$ref": "#/definitions/GUID" },
        "QuestionScope": { "$ref": "#/definitions/QuestionScope" },
        "QuestionText": { "type": "string" },
        "VariableLabel": { "$ref": "#/definitions/VariableLabel" },
        "ValidationConditions": { "$ref": "#/definitions/ValidationConditions" },
        "VariableName": { "$ref": "#/definitions/VariableName" },

        "ShowAsList": { "type": "boolean", "default": false },
        "ShowAsListThreshold": { "type": "integer" },

        "CategoriesId": { "$ref": "#/definitions/GUID" },
        "Answers": { "$ref": "#/definitions/Answers" },

        "CascadeFromQuestionId": { "$ref": "#/definitions/GUID" },

        "IsFilteredCombobox": { "type": "boolean", "default": false },
        "LinkedToId": { "$ref": "#/definitions/GUID" },
        "FilterExpression": { "type": "string" }
      },
      "additionalProperties": false,
      "required": [ "Id", "Type"]
    },

    "StaticText": {
      "type": "object",
      "properties": {
        "Type": { "const": "StaticText" },
        "VariableName": { "$ref": "#/definitions/VariableName" },
        "Id": { "$ref": "#/definitions/GUID" },
        "Text": { "type": "string" },
        "AttachmentName": { "type": "string" },
        "ValidationConditions": { "$ref": "#/definitions/ValidationConditions" },
        "ConditionExpression": { "type": "string" },
        "HideIfDisabled": { "type": "boolean", "default": false }
      },
      "additionalProperties": false,
      "required": ["Type", "Id"]
    },

    "TextListQuestion": {
      "type": "object",
      "properties": {
        "Type": {"const": "TextListQuestion"},
        "ConditionExpression": { "type": "string" },
        "HideIfDisabled": { "type": "boolean", "default": false },
        "Instructions": { "type": "string" },
        "HideInstructions": { "type": "boolean", "default": false },
        "Id": { "$ref": "#/definitions/GUID" },
        "QuestionScope": { "$ref": "#/definitions/QuestionScope" },
        "QuestionText": { "type": "string" },
        "VariableLabel": { "$ref": "#/definitions/VariableLabel" },
        "ValidationConditions": { "$ref": "#/definitions/ValidationConditions" },
        "VariableName": { "$ref": "#/definitions/VariableName" },
  
        "MaxItemsCount": { "type": "integer" }
      },
      "additionalProperties": false,
      "required": ["Id", "Type"]
    },

    "TextQuestion": {
      "type": "object",
      "properties": {
        "Type": { "const" : "TextQuestion" },
        "ConditionExpression": { "type": "string" },
        "HideIfDisabled": { "type": "boolean", "default": false },
        "Instructions": { "type": "string" },
        "HideInstructions": { "type": "boolean", "default": false },
        "Id": { "$ref": "#/definitions/GUID" },
        "QuestionScope": { "$ref": "#/definitions/QuestionScope" },
        "QuestionText": { "type": "string" },
        "VariableLabel": { "$ref": "#/definitions/VariableLabel" },
        "ValidationConditions": { "$ref": "#/definitions/ValidationConditions" },
        "VariableName": { "$ref": "#/definitions/VariableName" },

        "Mask": { "type": "string" }
      },
      "additionalProperties": false,
      "required": ["Id", "Type"]
    },

    "Translation": {
      "type": "object",
      "properties": {
        "Id": { "type": "string" },
        "Name": { "type": "string" }
      },
      "additionalProperties": false,
      "required": ["Id", "Name"]
    },

    "ValidationCondition": {
      "type": "object",
      "properties": {
        "Expression": { "type": "string" },
        "Message": { "type": "string" },
        "Severity": {
          "type": "string",
          "oneOf": [
            { "const": "Error", "description": "Error" },
            { "const": "Warning", "description": "Warning" }
          ],
          "default": "Error"
        }
      },
      "additionalProperties": false,
      "required": ["Expression"]
    },

    "Variable": {
      "type": "object",
      "properties": {
        "Label": { "$ref": "#/definitions/VariableLabel" },
        "Id": { "$ref": "#/definitions/GUID" },
        "VariableType": {
          "type": "string",
          "oneOf": [
            { "const": "LongInteger", "description": "Long Integer" },
            { "const": "Double", "description": "Double" },
            { "const": "Boolean", "description": "Boolean" },
            { "const": "DateTime", "description": "Date/Time" },
            { "const": "String", "description": "String" }
          ],
          "default": "Boolean"
        },
        "Expression": { "type": "string" },
        "DoNotExport": { "type": "boolean", "default": false },
        "VariableName": { "$ref": "#/definitions/VariableName" }
      },
      "additionalOptions": false,
      "required": ["Id", "VariableName", "Expression"]
    },

    "VariableLabel": { "type": "string", "maxLength": 80 },

    "VariableName": { "type": "string", "maxLength": 32 },

    "QuestionnaireMetaInfo": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "SubTitle": { "type": [ "null", "string" ] },
        "StudyType": {
          "type": "string",
          "oneOf": [
            { "const": "AdministrativeRecords", "description": "Administrative Records" },
            { "const": "AgriculturalCensus", "description": "Agricultural Census" },
            { "const": "AgriculturalSurvey", "description": "Agricu lturalSurvey" },
            { "const": "ChildLaborSurvey", "description": "Child Labor Survey" },
            { "const": "CoreWelfareIndicatorsQuestionnaire", "description": "Core Welfare Indicators Questionnaire" },
            { "const": "DemographicAndHealthSurvey", "description": "Demographic And Health Survey" },
            { "const": "EnterpriseSurvey", "description": "Enterprise Survey" },
            { "const": "EnterpriseCensus", "description": "Enterprise Census" },
            { "const": "InformalSectorSurvey", "description": "Informal Sector Survey" },
            { "const": "IntegratedSurvey", "description": "Integrated Survey" },
            { "const": "MultipleIndicatorClusterSurvey", "description": "Multiple Indicator Cluster Survey" },
            { "const": "LaborForceSurvey", "description": "Labor Force Survey" },
            { "const": "LivingStandardsMeasurementStudy", "description": "Living Standards Measurement Study" },
            { "const": "HouseholdHealthSurvey", "description": "Household Health Survey" },
            { "const": "HouseholdSurvey", "description": "Household Survey" },
            { "const": "PriceSurvey", "description": "Price Survey" },
            { "const": "PrioritySurvey", "description": "Priority Survey" },
            { "const": "PopulationAndHousingCensus", "description": "Population And Housing Census" },
            { "const": "SampleFrame", "description": "Sample Frame" },
            { "const": "ServiceProvisionAssessments", "description": "Service Provision Assessments" },
            { "const": "SocioEconomicMonitoringSurvey", "description": "SocioE conomic Monitoring Survey" },
            { "const": "StatisticalInfoAndMonitoringProg", "description": "Statistical Info And Monitoring Prog" },
            { "const": "WorldFertilitySurvey", "description": "World Fertility Survey" },
            { "const": "WorldHealthSurvey", "description": "World Health Survey" },
          ],
          "default": "AdministrativeRecords"
        }, 
        "Version": { "type": [ "string", "null" ] },
        "VersionNotes": { "type": [ "string", "null" ] },
        "KindOfData": { "type": [ "string", "null" ] },
        "Country": { "type": [ "string", "null" ] },
        "Year": { "type": [ "integer", "null" ], "format": "int32" },
        "Language": { "type": [ "string", "null" ] },
        "Coverage": { "type": [ "string", "null" ] },
        "Universe": { "type": [ "string", "null" ] },
        "UnitOfAnalysis": { "type": [ "string", "null" ] },
        "PrimaryInvestigator": { "type": [ "string", "null" ] },
        "Funding": { "type": [ "string", "null" ] },
        "Consultant": { "type": [ "string", "null" ] },
        "ModeOfDataCollection": {
          "type": "string",
          "oneOf": [
            { "const": "Capi", "description": "Capi" },
            { "const": "Cati", "description": "Cati" },
            { "const": "FaceToFace", "description": "Face To Face" },
            { "const": "Mail", "description": "Mail" },
            { "const": "FocusGroup", "description": "Focus Group" },
            { "const": "Internet", "description": "Internet" },
            { "const": "Other", "description": "Other" }
          ],
          "default": "Error"
        },
        "Notes": { "type": [ "string", "null" ] },
        "Keywords": { "type": [ "string", "null" ] },
        "AgreeToMakeThisQuestionnairePublic": { "type": "boolean", "default": false }
      }
    }
  }
}