{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://docs.mysurvey.solutions/schemas/questionnaire.schema.json",
  "title": "Questionnaire Document",
  "description": "Survey Solutions questionnaire document",
  "type": "object",
  "additionalProperties": false,
  
  "properties": {
    "CoverPageSectionId": { "$ref": "#/definitions/GUID" },
    "DefaultTranslation": { "type": "string" },
    "CreationDate": { "type": "string", "format": "date-time" },
    "LastEntryDate": { "type": "string", "format": "date-time" },
    "CreatedBy": { "type": "string" },
    "Id": { "$ref": "#/definitions/GUID" },
    "Title": { "type": "string" },
    "Description": { "type": "string" },
    "VariableName": { "$ref": "#/definitions/VariableName" },
    "DefaultLanguageName": { "type": "string" },
    "HideIfDisabled": { "type": "boolean", "default": false },
    "IsPublic": { "type": "boolean" },
    "IsDeleted": { "type": "boolean" },
    
    "Children": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/Group"
      },
      "minItems": 0
    },
    "Macros": {
      "type": "object",
      "additionalProperties": {
        "$ref": "#/definitions/Macro"
      }
    },
    "LookupTables": {
      "type": "object",
      "additionalProperties": {
        "$ref": "#/definitions/LookupTable"
      }
    },
    "Attachments": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/Attachment"
      }
    },
    "Translations": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/Translation"
      }
    },
    "Categories": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/Categories"
      }
    },
    "Metadata": { "$ref": "#/definitions/QuestionnaireMetaInfo" }
  },

  "required": ["Id", "Children", "Title"],

  "definitions": {
    "Answer": {
      "type": "object",
      "properties": {
        "Text": { "type": "string" },
        "Code": { "type": "number" },
        "ParentCode": { "type": "number" },
      },
      "additionalProperties": false,
      "required": ["Text", "Code"]
    },
  
    "Answers": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/Answer"
      }
    },

    "AreaQuestion": {
      "type": "object",
      "properties": {
        "type": { "const": "AreaQuestion" },
        "ConditionExpression": { "type": "string" },
        "HideIfDisabled": { "type": "boolean" },
        "Instructions": { "type": "string" },
        "HideInstructions": { "type": "boolean", "default": false },
        "GeometryType": {
          "type": "string",
          "oneOf": [
            { "const": "Polygon",    "description": "Polygon" },
            { "const": "Polyline",   "description": "Polyline" },
            { "const": "Point",      "description": "Point" },
            { "const": "Multipoint", "description": "Multipoint" }
          ],
          "default": "Polygon"
        },
        "PublicKey": { "$ref": "#/definitions/GUID" },
        "QuestionScope": { "$ref": "#/definitions/QuestionScope" },
        "QuestionText": { "type": "string" },
        "VariableLabel": { "$ref": "#/definitions/VariableLabel" },
        "ValidationConditions": { "$ref": "#/definitions/ValidationConditions" },
        "VariableName": { "$ref": "#/definitions/VariableName" }
      },
      "additionalProperties": false,
      "required": ["type", "VariableName"]
    },

    "Attachment": {
      "type": "object",
      "properties": {
        "AttachmentId": { "type": "string" },
        "Name": { "type": "string" },
        "ContentId": { "type": "string" }
      },
      "additionalProperties": false,
      "required": ["AttachmentId", "Name", "ContentId"]
    },

    "AudioQuestion": {
      "type": "object",
      "properties": {
        "type": { "const": "AudioQuestion" },
        "ConditionExpression": { "type": "string" },
        "HideIfDisabled": { "type": "boolean" },
        "Instructions": { "type": "string" },
        "HideInstructions": { "type": "boolean", "default": false },
        "PublicKey": { "$ref": "#/definitions/GUID" },
        "QuestionScope": { "$ref": "#/definitions/QuestionScope" },
        "QuestionText": { "type": "string" },
        "VariableLabel": { "$ref": "#/definitions/VariableLabel" },
        "ValidationConditions": { "$ref": "#/definitions/ValidationConditions" },
        "VariableName": { "$ref": "#/definitions/VariableName" }
      },
      "additionalProperties": false,
      "required": ["type", "VariableName"]
    },

    "Categories": {
      "type": "object",
      "properties": {
        "Id": { "type": "string" },
        "Name": { "type": "string" }
      },
      "additionalProperties": false,
      "required": ["Id", "Name"]
    },

    "DateTimeQuestion": {
      "type": "object",
      "properties": {
        "type": { "const": "DateTimeQuestion" },
        "ConditionExpression": { "type": "string" },
        "HideIfDisabled": { "type": "boolean" },
        "Instructions": { "type": "string" },
        "HideInstructions": { "type": "boolean", "default": false },
        "IsTimestamp": { "type": "boolean", "default": false },
        "DefaultDate": { "type": "string", "format": "date-time" },
        "PublicKey": { "$ref": "#/definitions/GUID" },
        "QuestionScope": { "$ref": "#/definitions/QuestionScope" },
        "QuestionText": { "type": "string" },
        "VariableLabel": { "$ref": "#/definitions/VariableLabel" },
        "ValidationConditions": { "$ref": "#/definitions/ValidationConditions" },
        "VariableName": { "$ref": "#/definitions/VariableName" }
      },
      "additionalProperties": false,
      "required": ["type"]
    },

    "FixedRosterTitle": {
      "type": "object",
      "properties": {
        "Value": { "type": "number" },
        "Title": { "type": "string" }
      },
      "additionalProperties": false,
      "required": ["Value", "Title"]
    },

    "GpsCoordinateQuestion": {
      "type": "object",
      "properties": {
        "type": { "const": "GpsCoordinateQuestion" },
        "ConditionExpression": { "type": "string" },
        "HideIfDisabled": { "type": "boolean" },
        "Instructions": { "type": "string" },
        "HideInstructions": { "type": "boolean", "default": false },
        "PublicKey": { "$ref": "#/definitions/GUID" },
        "QuestionScope": { "$ref": "#/definitions/QuestionScope" },
        "QuestionText": { "type": "string" },
        "VariableLabel": { "$ref": "#/definitions/VariableLabel" },
        "ValidationConditions": { "$ref": "#/definitions/ValidationConditions" },
        "VariableName": { "$ref": "#/definitions/VariableName" }
      },
      "additionalProperties": false,
      "required": ["type", "VariableName"]
    },

    "Group": {
      "type": "object",
      "properties": {
        "type": {"const": "Group"},
        "Children": {
          "type": "array",
          "items": {
            "oneOf": [
              {"$ref": "#/definitions/Group"},
              {"$ref": "#/definitions/StaticText"},
              {"$ref": "#/definitions/AreaQuestion"},
              {"$ref": "#/definitions/AudioQuestion"},
              {"$ref": "#/definitions/DateTimeQuestion"},
              {"$ref": "#/definitions/GpsCoordinateQuestion"},
              {"$ref": "#/definitions/MultimediaQuestion"},
              {"$ref": "#/definitions/MultiOptionsQuestion"},
              {"$ref": "#/definitions/NumericQuestion"},
              {"$ref": "#/definitions/QRBarcodeQuestion"},
              {"$ref": "#/definitions/SingleQuestion"},
              {"$ref": "#/definitions/TextListQuestion"},
              {"$ref": "#/definitions/TextQuestion"},
              {"$ref": "#/definitions/Variable"}
            ]
          }
        },
        "ConditionExpression": { "type": "string" },
        "HideIfDisabled": { "type": "boolean" },
        "IsRoster": { "type": "boolean" },
        "PublicKey": { "type": "string", "format": "uuid"},
        "Title": { "type": "string" },
        "Description": { "type": "string" },
        "VariableName": { "$ref": "#/definitions/VariableName" },


        "CustomRosterTitle": { "type": "boolean" },
        "DisplayMode": {
          "type": "string",
          "oneOf": [
            { "const": "SubSection", "description": "Sub Section" },
            { "const": "Flat", "description": "Flat" },
            { "const": "Table", "description": "Table" },
            { "const": "Matrix", "description": "Matrix" }
          ],
          "default": "SubSection"
        },
        "RosterSizeQuestionId": { "type": "string", "format": "uuid" },
        "RosterTitleQuestionId": { "type": "string", "format": "uuid" },
        "RosterSizeSource": {
          "type": "string",
          "oneOf": [
            { "const": "FixedTitles", "description": "Fixed Titles" },
            { "const": "Question", "description": "Question" },
          ],
          "default": "FixedTitles"
        },
        "FixedRosterTitles": {
          "type": [ "array", "null" ],
          "items": {
            "$ref": "#/definitions/FixedRosterTitle"
          }
        }
      },

      "if" : {
        "properties" : { "IsRoster": { "const": true } }
      },
      "then": {
        "properties": {
          
        }
      },
      "additionalProperties": false,
      "required": ["type", "PublicKey"]
    },

    "GUID": { "type": "string", "format": "uuid" },

    "ValidationConditions": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/ValidationCondition"
      },
      "maxItems": 10
    },

    "LookupTable": {
      "type": "object",
      "properties": {
        "TableName": {"type": "string"},
        "FileName": {"type": "string"}
      },
      "additionalProperties": false,
      "required": ["TableName", "FileName"]
    },

    "Macro": {
      "type": "object",
      "properties": {
        "Name": { "type": "string" },
        "Content": { "type": "string" },
        "Description": { "type": "string" }
      },
      "additionalProperties": false,
      "required": ["Name", "Content"]
    },

    "MultimediaQuestion": {
      "type": "object",
      "properties": {
        "type": { "const": "MultimediaQuestion" },
        "IsSignature": { "type": "boolean" },
        "ConditionExpression": { "type": "string" },
        "HideIfDisabled": { "type": "boolean" },
        "Instructions": { "type": "string" },
        "HideInstructions": { "type": "boolean", "default": false },
        "PublicKey": { "$ref": "#/definitions/GUID" },
        "QuestionScope": { "$ref": "#/definitions/QuestionScope" },
        "QuestionText": { "type": "string" },
        "VariableLabel": { "$ref": "#/definitions/VariableLabel" },
        "ValidationConditions": { "$ref": "#/definitions/ValidationConditions" },
        "VariableName": { "$ref": "#/definitions/VariableName" }
      },
      "additionalProperties": false,
      "required": ["PublicKey", "type"]
    },

    "MultiOptionsQuestion": {
      "type": "object",
      "properties": {
        "type": { "const": "MultiOptionsQuestion" },
        "ConditionExpression": { "type": "string" },
        "HideIfDisabled": { "type": "boolean" },
        "Instructions": { "type": "string" },
        "HideInstructions": { "type": "boolean", "default": false },
        "PublicKey": { "$ref": "#/definitions/GUID" },
        "QuestionScope": { "$ref": "#/definitions/QuestionScope" },
        "QuestionText": { "type": "string" },
        "VariableLabel": { "$ref": "#/definitions/VariableLabel" },
        "ValidationConditions": { "$ref": "#/definitions/ValidationConditions" },
        "VariableName": { "$ref": "#/definitions/VariableName" },

        "AreAnswersOrdered": { "type": "boolean" },
        "MaxAllowedAnswers": { "type": "integer" },
        "YesNoView": { "type": "boolean" },

        "CategoriesId": { "$ref": "#/definitions/GUID" },
        "Answers": { "$ref": "#/definitions/Answers" },
        "CascadeFromQuestionId": { "$ref": "#/definitions/GUID" },

        "IsFilteredCombobox": { "type": "boolean" },
        "OptionsFilterExpression": { "type": "string" },
        "LinkedFilterExpression": { "type": "string" },
        "LinkedToRosterId": { "$ref": "#/definitions/GUID" },
        "LinkedToQuestionId": { "$ref": "#/definitions/GUID" }
      },
      "additionalProperties": false,
      "required": ["PublicKey", "type"]
    },

    "NumericQuestion": {
      "type": "object",
      "properties": {
        "type": { "const": "NumericQuestion" },
        "ConditionExpression": { "type": "string" },
        "HideIfDisabled": { "type": "boolean" },
        "Instructions": { "type": "string" },
        "HideInstructions": { "type": "boolean", "default": false },
        "PublicKey": { "$ref": "#/definitions/GUID" },
        "QuestionScope": { "$ref": "#/definitions/QuestionScope" },
        "QuestionText": { "type": "string" },
        "VariableLabel": { "$ref": "#/definitions/VariableLabel" },
        "ValidationConditions": { "$ref": "#/definitions/ValidationConditions" },
        "VariableName": { "$ref": "#/definitions/VariableName" },

        "Answers": { "$ref": "#/definitions/Answers" },
        "CountOfDecimalPlaces": { "type": "integer", "minimum": 0 },
        "IsInteger": { "type": "boolean", "default": true },
        "UseFormatting": { "type": "boolean", "default": false }
      },
      "additionalProperties": false,
      "required": ["PublicKey", "type"]
    },

    "QRBarcodeQuestion": {
      "type": "object",
      "properties": {
        "type": { "const": "QRBarcodeQuestion" },
        "ConditionExpression": { "type": "string" },
        "HideIfDisabled": { "type": "boolean" },
        "Instructions": { "type": "string" },
        "HideInstructions": { "type": "boolean", "default": false },
        "PublicKey": { "$ref": "#/definitions/GUID" },
        "QuestionScope": { "$ref": "#/definitions/QuestionScope" },
        "QuestionText": { "type": "string" },
        "VariableLabel": { "$ref": "#/definitions/VariableLabel" },
        "ValidationConditions": { "$ref": "#/definitions/ValidationConditions" },
        "VariableName": { "$ref": "#/definitions/VariableName" }
      },
      "additionalProperties": false,
      "required": ["PublicKey", "type"]
    },

    "QuestionScope": {
      "type": "string",
      "description": "",
      "x-enumNames": [
        "Interviewer",
        "Supervisor",
        "Headquarter",
        "Hidden"
      ],
      "enum": [
        "Interviewer",
        "Supervisor",
        "Headquarter",
        "Hidden"
      ]
    },

    "SingleQuestion": {
      "type": "object",
      "properties": {
        "type": { "const": "SingleQuestion" },
        "ConditionExpression": { "type": "string" },
        "HideIfDisabled": { "type": "boolean", "default": false },
        "Instructions": { "type": "string" },
        "HideInstructions": { "type": "boolean", "default": false },
        "PublicKey": { "$ref": "#/definitions/GUID" },
        "QuestionScope": { "$ref": "#/definitions/QuestionScope" },
        "QuestionText": { "type": "string" },
        "VariableLabel": { "$ref": "#/definitions/VariableLabel" },
        "ValidationConditions": { "$ref": "#/definitions/ValidationConditions" },
        "VariableName": { "$ref": "#/definitions/VariableName" },

        "ShowAsList": { "type": "boolean" },
        "ShowAsListThreshold": { "type": "integer" },

        "CategoriesId": { "$ref": "#/definitions/GUID" },
        "Answers": { "$ref": "#/definitions/Answers" },

        "CascadeFromQuestionId": { "$ref": "#/definitions/GUID" },

        "IsFilteredCombobox": { "type": "boolean", "default": false },
        "LinkedToRosterId": { "$ref": "#/definitions/GUID" },
        "LinkedToQuestionId": { "$ref": "#/definitions/GUID" },
        "LinkedFilterExpression": { "type": "string" }
      },
      "additionalProperties": false,
      "required": ["type"]
    },

    "StaticText": {
      "type": "object",
      "properties": {
        "type": { "const": "StaticText" },
        "VariableName": { "$ref": "#/definitions/VariableName" },
        "PublicKey": { "$ref": "#/definitions/GUID" },
        "Text": { "type": "string" },
        "AttachmentName": { "type": "string" },
        "ValidationConditions": { "$ref": "#/definitions/ValidationConditions" },
        "ConditionExpression": { "type": "string" },
        "HideIfDisabled": { "type": "boolean", "default": false }
      },
      "additionalProperties": false,
      "required": ["type", "PublicKey"]
    },

    "TextListQuestion": {
      "type": "object",
      "properties": {
        "type": {"const": "TextListQuestion"},
        "ConditionExpression": { "type": "string" },
        "HideIfDisabled": { "type": "boolean" },
        "Instructions": { "type": "string" },
        "HideInstructions": { "type": "boolean", "default": false },
        "PublicKey": { "$ref": "#/definitions/GUID" },
        "QuestionScope": { "$ref": "#/definitions/QuestionScope" },
        "QuestionText": { "type": "string" },
        "VariableLabel": { "$ref": "#/definitions/VariableLabel" },
        "ValidationConditions": { "$ref": "#/definitions/ValidationConditions" },
        "VariableName": { "$ref": "#/definitions/VariableName" },
  
        "MaxAnswerCount": { "type": "integer" }
      },
      "additionalProperties": false,
      "required": ["PublicKey", "type"]
    },

    "TextQuestion": {
      "type": "object",
      "properties": {
        "type": { "const" : "TextQuestion" },
        "ConditionExpression": { "type": "string" },
        "HideIfDisabled": { "type": "boolean" },
        "Instructions": { "type": "string" },
        "HideInstructions": { "type": "boolean", "default": false },
        "PublicKey": { "$ref": "#/definitions/GUID" },
        "QuestionScope": { "$ref": "#/definitions/QuestionScope" },
        "QuestionText": { "type": "string" },
        "VariableLabel": { "$ref": "#/definitions/VariableLabel" },
        "ValidationConditions": { "$ref": "#/definitions/ValidationConditions" },
        "VariableName": { "$ref": "#/definitions/VariableName" },

        "Mask": { "type": "string" }
      },
      "additionalProperties": false,
      "required": ["PublicKey", "type"]
    },

    "Translation": {
      "type": "object",
      "properties": {
        "Id": { "type": "string" },
        "Name": { "type": "string" }
      },
      "additionalProperties": false,
      "required": ["Id", "Name"]
    },

    "ValidationCondition": {
      "type": "object",
      "properties": {
        "Expression": { "type": "string" },
        "Message": { "type": "string" },
        "Severity": {
          "type": "string",
          "oneOf": [
            { "const": "Error", "description": "Error" },
            { "const": "Warning", "description": "Warning" }
          ],
          "default": "Error"
        }
      },
      "additionalProperties": false,
      "required": ["Expression", "Message"]
    },

    "Variable": {
      "type": "object",
      "properties": {
        "Label": { "$ref": "#/definitions/VariableLabel" },
        "PublicKey": { "$ref": "#/definitions/GUID" },
        "Type": {
          "type": "string",
          "oneOf": [
            { "const": "LongInteger", "description": "Long Integer" },
            { "const": "Double", "description": "Double" },
            { "const": "Boolean", "description": "Boolean" },
            { "const": "DateTime", "description": "Date/Time" },
            { "const": "String", "description": "String" }
          ],
          "default": "Boolean"
        },
        "Name": { "type": "string" },
        "Expression": { "type": "string" },
        "DoNotExport": { "type": "boolean", "default": false },
        "VariableName": { "$ref": "#/definitions/VariableName" }
      },
      "additionalOptions": false,
      "required": ["PublicKey", "Name", "Expression"]
    },

    "VariableLabel": { "type": "string", "maxLength": 80 },

    "VariableName": { "type": "string", "maxLength": 32 },

    "QuestionnaireMetaInfo": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "SubTitle": { "type": [ "null", "string" ] },
        "StudyType": {
          "type": "string",
          "oneOf": [
            { "const": "AdministrativeRecords", "description": "AdministrativeRecords" },
            { "const": "AgriculturalCensus", "description": "AgriculturalCensus" },
            { "const": "AgriculturalSurvey", "description": "AgriculturalSurvey" },
            { "const": "ChildLaborSurvey", "description": "ChildLaborSurvey" },
            { "const": "CoreWelfareIndicatorsQuestionnaire", "description": "CoreWelfareIndicatorsQuestionnaire" },
            { "const": "DemographicAndHealthSurvey", "description": "DemographicAndHealthSurvey" },
            { "const": "EnterpriseSurvey", "description": "EnterpriseSurvey" },
            { "const": "EnterpriseCensus", "description": "EnterpriseCensus" },
            { "const": "InformalSectorSurvey", "description": "InformalSectorSurvey" },
            { "const": "IntegratedSurvey", "description": "IntegratedSurvey" },
            { "const": "MultipleIndicatorClusterSurvey", "description": "MultipleIndicatorClusterSurvey" },
            { "const": "LaborForceSurvey", "description": "LaborForceSurvey" },
            { "const": "LivingStandardsMeasurementStudy", "description": "LivingStandardsMeasurementStudy" },
            { "const": "HouseholdHealthSurvey", "description": "HouseholdHealthSurvey" },
            { "const": "HouseholdSurvey", "description": "HouseholdSurvey" },
            { "const": "PriceSurvey", "description": "PriceSurvey" },
            { "const": "PrioritySurvey", "description": "PrioritySurvey" },
            { "const": "PopulationAndHousingCensus", "description": "PopulationAndHousingCensus" },
            { "const": "SampleFrame", "description": "SampleFrame" },
            { "const": "ServiceProvisionAssessments", "description": "ServiceProvisionAssessments" },
            { "const": "SocioEconomicMonitoringSurvey", "description": "SocioEconomicMonitoringSurvey" },
            { "const": "StatisticalInfoAndMonitoringProg", "description": "StatisticalInfoAndMonitoringProg" },
            { "const": "WorldFertilitySurvey", "description": "WorldFertilitySurvey" },
            { "const": "WorldHealthSurvey", "description": "WorldHealthSurvey" },
          ],
          "default": "AdministrativeRecords"
        }, 
        "Version": {
          "type": [
            "null",
            "string"
          ]
        },
        "VersionNotes": {
          "type": [
            "null",
            "string"
          ]
        },
        "KindOfData": {
          "type": [
            "null",
            "string"
          ]
        },
        "Country": {
          "type": [
            "null",
            "string"
          ]
        },
        "Year": {
          "type": [
            "integer",
            "null"
          ],
          "format": "int32"
        },
        "Language": {
          "type": [
            "null",
            "string"
          ]
        },
        "Coverage": {
          "type": [
            "null",
            "string"
          ]
        },
        "Universe": {
          "type": [
            "null",
            "string"
          ]
        },
        "UnitOfAnalysis": {
          "type": [
            "null",
            "string"
          ]
        },
        "PrimaryInvestigator": {
          "type": [
            "null",
            "string"
          ]
        },
        "Funding": {
          "type": [
            "null",
            "string"
          ]
        },
        "Consultant": {
          "type": [
            "null",
            "string"
          ]
        },
        "ModeOfDataCollection": {
          "type": "string",
          "oneOf": [
            { "const": "Capi", "description": "Capi" },
            { "const": "Cati", "description": "Cati" },
            { "const": "FaceToFace", "description": "Face To Face" },
            { "const": "Mail", "description": "Mail" },
            { "const": "FocusGroup", "description": "Focus Group" },
            { "const": "Internet", "description": "Internet" },
            { "const": "Other", "description": "Other" }
          ],
          "default": "Error"
        },
        "Notes": {
          "type": [
            "null",
            "string"
          ]
        },
        "Keywords": {
          "type": [
            "null",
            "string"
          ]
        },
        "AgreeToMakeThisQuestionnairePublic": {
          "type": "boolean"
        }
      }
    }
  }
}